(()=>{const e=document.querySelector(".project-list"),t=document.querySelector("[data-new-project-form]"),n=document.querySelector(".new-project-input"),a=document.querySelector(".btn-delete-project"),d=document.querySelector(".btn-new-project"),l=document.querySelector(".todo-content"),o=document.querySelector(".todo-title"),s=document.querySelector(".task-count"),c=document.querySelector(".all-tasks"),r=document.querySelector(".btn-delete-complete"),u=document.getElementById("task-template"),m=document.querySelector(".new-task-form"),p=document.querySelector(".new-task-title-input"),k=document.querySelector(".new-task-date"),y=document.querySelector(".new-task-details"),f=document.getElementsByName("create-new-priority"),S=document.querySelector("#btn-add-task"),v=document.querySelector(".edit-task-form"),g=document.querySelector(".edit-task-title-input"),q=document.querySelector(".edit-task-date"),b=document.querySelector(".edit-task-details"),L=document.getElementsByName("edit-priority");document.querySelector("#btn-edit-task");let h=JSON.parse(localStorage.getItem("project.lists"))||[],w=localStorage.getItem("project.selectedListId");function E(){const t=document.querySelector(".edit-task-container"),n=document.querySelector(".newtask");t.classList.add("edit-not-active"),n.classList.remove("new-not-active"),function(){a.disabled=!1,r.disabled=!1,d.disabled=!1,S.disabled=!1,document.querySelectorAll(".btn-task-delete").forEach((e=>e.disabled=!1));let e=document.getElementsByTagName("input");for(i=0;i<e.length;i++)"checkbox"==e[i].type&&(e[i].disabled=!1)}(),e.classList.remove("project-list-none")}function j(){localStorage.setItem("project.lists",JSON.stringify(h)),localStorage.setItem("project.selectedListId",w)}function I(){D(e),h.forEach((t=>{const i=document.createElement("li");i.dataset.projId=t.id,i.classList.add("project-list-name"),i.innerText=t.name,t.id===w&&i.classList.add("active-project"),e.appendChild(i)}));const t=h.find((e=>e.id===w));"null"==w||null===w?l.style.display="none":(l.style.display="",o.innerText=t.name,N(t),D(c),function(e){e.tasks.forEach((e=>{const t=document.importNode(u.content,!0),i=t.querySelector(".task-row");"low"==e.priority?i.classList.add("task-low"):"medium"==e.priority?i.classList.add("task-medium"):i.classList.add("task-high");const n=t.querySelector("input");n.id=e.id,n.checked=e.complete;const a=t.querySelector("label");a.htmlFor=e.id,a.append(e.name),t.querySelector(".task-date").append(e.dueDate),t.querySelector(".task-priority").append(e.priority),t.querySelector(".task-notes").append(e.notes),t.querySelector(".btn-task-details").id="details-"+e.id,t.querySelector(".btn-task-edit").id="edit-"+e.id,t.querySelector(".btn-task-delete").id="delete-"+e.id,t.querySelector(".task-details-row").id="row-"+e.id,c.appendChild(t)}))}(t))}function N(e){const t=e.tasks.filter((e=>!e.complete)).length,i=1===t?"task":"tasks";s.innerText=`${t} ${i} remaining`}function D(e){for(;e.firstChild;)e.removeChild(e.firstChild)}e.addEventListener("click",(e=>{"li"===e.target.tagName.toLowerCase()&&(w=e.target.dataset.projId,j(),I())})),c.addEventListener("click",(e=>{if("input"===e.target.tagName.toLowerCase()){const t=h.find((e=>e.id===w));t.tasks.find((t=>t.id===e.target.id)).complete=e.target.checked,j(),N(t)}})),r.addEventListener("click",(e=>{let t=h.find((e=>e.id===w));0===t.tasks.filter((e=>e.complete)).length?alert("No completed task to delete"):(t=h.find((e=>e.id===w)),t.tasks=t.tasks.filter((e=>!e.complete)),j(),I())})),c.addEventListener("click",(e=>{if(e.target.classList.contains("btn-task-details")){const t=e.target.id.split("-");document.getElementById("row-"+t[1]).classList.toggle("active-details")}})),c.addEventListener("click",(t=>{if(t.target.classList.contains("btn-task-edit")){!function(){a.disabled=!0,r.disabled=!0,d.disabled=!0,S.disabled=!0,document.querySelectorAll(".btn-task-delete").forEach((e=>e.disabled=!0));let e=document.getElementsByTagName("input");for(i=0;i<e.length;i++)"checkbox"==e[i].type&&(e[i].disabled=!0)}();let n=t.target.id.split("-")[1];const l=h.find((e=>e.id===w));let o=l.tasks.find((e=>e.id===n));!function(t){e.classList.add("project-list-none");const n=document.querySelector(".edit-task-container"),a=document.querySelector(".newtask");for(n.classList.remove("edit-not-active"),a.classList.add("new-not-active"),g.value=t.name,b.value=t.notes,q.value=t.dueDate,i=0;i<L.length;i++)L[i].value==t.priority&&(L[i].checked=!0)}(o),v.addEventListener("submit",(e=>{e.preventDefault(),o=l.tasks.find((e=>e.id===n));const t=g.value,a=q.value,d=b.value;let s="";for(i=0;i<L.length;i++)L[i].checked&&(s=L[i].value);o.name=t,o.notes=d,o.dueDate=a,o.priority=s,j(),E(),I()})),document.querySelector("#btn-cancel-edit-task").addEventListener("click",(()=>{E()}))}})),c.addEventListener("click",(e=>{if(e.target.classList.contains("btn-task-delete")){let t=e.target.id.split("-")[1];const i=h.find((e=>e.id===w));i.tasks=i.tasks.filter((e=>e.id!==t)),j(),I()}})),a.addEventListener("click",(e=>{h=h.filter((e=>e.id!==w)),w=null,j(),I()})),t.addEventListener("submit",(e=>{e.preventDefault();const t=(i=n.value,{id:Date.now().toString(),name:i,tasks:[]});var i;n.value=null,h.push(t),j(),I()})),m.addEventListener("submit",(e=>{if(e.preventDefault(),"null"==w||null===w)return void alert("Please select a project to add the new task.");const t=p.value,n=k.value,a=y.value;let d="";for(i=0;i<f.length;i++)f[i].checked&&(d=f[i].value);if(null==t||""===t)return;const l=(o=t,s=a,c=n,r=d,{id:Date.now().toString(),name:o,complete:!1,dueDate:c,notes:s,priority:r});var o,s,c,r;p.value=null,y.value=null,h.find((e=>e.id===w)).tasks.push(l),j(),I()})),I()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFDeEJJLEVBQVd4RixFQUFZb0YsTUFDdkJLLEVBQVd4RixFQUFZbUYsTUFDN0IsSUFBSU0sRUFBZSxHQUVuQixJQUFLOUQsRUFBSSxFQUFHQSxFQUFJMUIsRUFBZ0IyQixPQUFRRCxJQUVoQzFCLEVBQWdCMEIsR0FBRzhCLFVBQ25CZ0MsRUFBZXhGLEVBQWdCMEIsR0FBR3dELE9BSzFDLEdBQWdCLE1BQVpHLEdBQWlDLEtBQWJBLEVBQWlCLE9BRXpDLE1BQU1uQyxHQXFCVVIsRUFyQlEyQyxFQXFCRnZCLEVBckJZeUIsRUFxQkxPLEVBckJlUixFQXFCVC9CLEVBckJtQmlDLEVBc0IvQyxDQUNIaEQsR0FBSWtELEtBQUtDLE1BQU1DLFdBQ2ZsRCxLQUFNQSxFQUNOZSxVQUFVLEVBQ1ZJLFFBQVNpQyxFQUNUaEMsTUFBT0EsRUFDUFAsU0FBVUEsSUFQbEIsSUFBb0JiLEVBQU1vQixFQUFPZ0MsRUFBTXZDLEVBcEJuQzFELEVBQWFxRixNQUFRLEtBQ3JCbkYsRUFBWW1GLE1BQVEsS0FFSTFFLEVBQVNxQyxNQUFLVixHQUFXQSxFQUFRSyxLQUFPM0IsSUFDaERvQyxNQUFNNEMsS0FBSzNDLEdBRTNCcEIsSUFDQUcsR0FBUSxJQWdKWkEsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBwcm9qZWN0Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9qZWN0LWxpc3RcIik7XG5jb25zdCBuZXdQcm9qZWN0Rm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLW5ldy1wcm9qZWN0LWZvcm1dJyk7XG5jb25zdCBuZXdQcm9qZWN0SW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm5ldy1wcm9qZWN0LWlucHV0XCIpO1xuY29uc3QgZGVsZXRlUHJvamVjdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYnRuLWRlbGV0ZS1wcm9qZWN0XCIpO1xuY29uc3QgbmV3UHJvamVjdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYnRuLW5ldy1wcm9qZWN0XCIpO1xuXG5jb25zdCBwcm9qZWN0RGlzcGxheUNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudG9kby1jb250ZW50XCIpO1xuY29uc3QgcHJvamVjdFRpdGxlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudG9kby10aXRsZVwiKTtcbmNvbnN0IHRhc2tzQ291bnRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50YXNrLWNvdW50XCIpO1xuY29uc3QgdGFza3NDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmFsbC10YXNrc1wiKTtcbmNvbnN0IHRhc2tEZWxldGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ0bi1kZWxldGUtY29tcGxldGVcIik7XG5cbmNvbnN0IHRhc2tUZW1wbGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGFzay10ZW1wbGF0ZVwiKTtcblxuY29uc3QgbmV3VGFza0Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm5ldy10YXNrLWZvcm1cIik7XG5jb25zdCBuZXdUYXNrSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm5ldy10YXNrLXRpdGxlLWlucHV0XCIpO1xuY29uc3QgbmV3VGFza0RhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm5ldy10YXNrLWRhdGVcIik7XG5jb25zdCBuZXdUYXNrTm90ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubmV3LXRhc2stZGV0YWlsc1wiKTtcbmNvbnN0IG5ld1Rhc2tQcmlvcml0eSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKFwiY3JlYXRlLW5ldy1wcmlvcml0eVwiKTtcbmNvbnN0IG5ld1Rhc2tCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2J0bi1hZGQtdGFza1wiKTtcblxuY29uc3QgZWRpdFRhc2tGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lZGl0LXRhc2stZm9ybVwiKTtcbmNvbnN0IGVkaXRUYXNrSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtdGFzay10aXRsZS1pbnB1dFwiKTtcbmNvbnN0IGVkaXRUYXNrRGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWRpdC10YXNrLWRhdGVcIik7XG5jb25zdCBlZGl0VGFza05vdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtdGFzay1kZXRhaWxzXCIpO1xuY29uc3QgZWRpdFRhc2tQcmlvcml0eSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKFwiZWRpdC1wcmlvcml0eVwiKTtcbmNvbnN0IGVkaXRUYXNrQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNidG4tZWRpdC10YXNrXCIpO1xuXG5sZXQgcHJvamVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcm9qZWN0Lmxpc3RzJykpIHx8IFtdO1xubGV0IHNlbGVjdGVkUHJvamVjdElkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Byb2plY3Quc2VsZWN0ZWRMaXN0SWQnKTtcblxuLy91cGRhdGUgc2VsZWN0ZWQgcHJvamVjdFxucHJvamVjdENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuXG4gICAgaWYgKGUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2xpJykge1xuXG4gICAgICAgIHNlbGVjdGVkUHJvamVjdElkID0gZS50YXJnZXQuZGF0YXNldC5wcm9qSWQ7XG5cbiAgICAgICAgc2F2ZSgpO1xuICAgICAgICByZW5kZXIoKTtcbiAgICB9XG59KVxuXG4vL3VwZGF0ZSBpbmNvbXBsZXRlIHRhc2sgY291bnRcbnRhc2tzQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG5cbiAgICBpZiAoZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnKSB7XG5cbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRQcm9qZWN0ID0gcHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT09IHNlbGVjdGVkUHJvamVjdElkKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRUYXNrID0gc2VsZWN0ZWRQcm9qZWN0LnRhc2tzLmZpbmQodGFzayA9PiB0YXNrLmlkID09PSBlLnRhcmdldC5pZCk7XG4gICAgICAgIHNlbGVjdGVkVGFzay5jb21wbGV0ZSA9IGUudGFyZ2V0LmNoZWNrZWQ7XG5cbiAgICAgICAgc2F2ZSgpO1xuICAgICAgICByZW5kZXJUYXNrQ291bnQoc2VsZWN0ZWRQcm9qZWN0KTtcbiAgICB9XG59KVxuXG4vL2RlbGV0ZSBhbGwgY29tcGxldGVkIHRhc2tzXG50YXNrRGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG5cbiAgICBsZXQgc2VsZWN0ZWRQcm9qZWN0ID0gcHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT09IHNlbGVjdGVkUHJvamVjdElkKTtcbiAgICBjb25zdCBjb21wbGV0ZWRUYXNrQ291bnQgPSBzZWxlY3RlZFByb2plY3QudGFza3MuZmlsdGVyKHRhc2sgPT4gdGFzay5jb21wbGV0ZSkubGVuZ3RoO1xuXG4gICAgaWYgKGNvbXBsZXRlZFRhc2tDb3VudCA9PT0gMCkge1xuXG4gICAgICAgIGFsZXJ0KFwiTm8gY29tcGxldGVkIHRhc2sgdG8gZGVsZXRlXCIpO1xuXG4gICAgfSBlbHNlIHtcblxuICAgICAgICBzZWxlY3RlZFByb2plY3QgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PT0gc2VsZWN0ZWRQcm9qZWN0SWQpO1xuICAgICAgICBzZWxlY3RlZFByb2plY3QudGFza3MgPSBzZWxlY3RlZFByb2plY3QudGFza3MuZmlsdGVyKHRhc2sgPT4gIXRhc2suY29tcGxldGUpO1xuXG4gICAgICAgIHNhdmUoKTtcbiAgICAgICAgcmVuZGVyKCk7XG4gICAgfVxuXG59KVxuXG4vL29wZW4gc3BlY2lmaWMgdGFzayBkZXRhaWxzXG50YXNrc0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuXG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnYnRuLXRhc2stZGV0YWlscycpKSB7XG5cbiAgICAgICAgY29uc3QgaWQgPSBlLnRhcmdldC5pZC5zcGxpdChcIi1cIik7XG4gICAgICAgIGNvbnN0IGRldGFpbHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJvdy1cIiArIGlkWzFdKTtcblxuICAgICAgICBkZXRhaWxzLmNsYXNzTGlzdC50b2dnbGUoXCJhY3RpdmUtZGV0YWlsc1wiKTtcblxuICAgIH1cbn0pXG5cbmZ1bmN0aW9uIGRpc2FibGVNb2RlKCkge1xuXG4gICAgZGVsZXRlUHJvamVjdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgdGFza0RlbGV0ZUJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgbmV3UHJvamVjdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgbmV3VGFza0J1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICBsZXQgZGVsZXRlVGFza0J1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJ0bi10YXNrLWRlbGV0ZVwiKTtcbiAgICBkZWxldGVUYXNrQnV0dG9ucy5mb3JFYWNoKGJ0biA9PiBidG4uZGlzYWJsZWQgPSB0cnVlKTtcblxuICAgIGxldCBjaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaW5wdXRcIik7XG4gICAgZm9yIChpID0gMDsgaSA8IGNoZWNrYm94Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChjaGVja2JveFtpXS50eXBlID09IFwiY2hlY2tib3hcIikge1xuICAgICAgICAgICAgY2hlY2tib3hbaV0uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGVuYWJsZU1vZGUoKSB7XG5cbiAgICBkZWxldGVQcm9qZWN0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgdGFza0RlbGV0ZUJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIG5ld1Byb2plY3RCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBuZXdUYXNrQnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG5cbiAgICBsZXQgZGVsZXRlVGFza0J1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJ0bi10YXNrLWRlbGV0ZVwiKTtcbiAgICBkZWxldGVUYXNrQnV0dG9ucy5mb3JFYWNoKGJ0biA9PiBidG4uZGlzYWJsZWQgPSBmYWxzZSk7XG5cbiAgICBsZXQgY2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImlucHV0XCIpO1xuICAgIGZvciAoaSA9IDA7IGkgPCBjaGVja2JveC5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoY2hlY2tib3hbaV0udHlwZSA9PSBcImNoZWNrYm94XCIpIHtcbiAgICAgICAgICAgIGNoZWNrYm94W2ldLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgIH1cbn1cblxuZnVuY3Rpb24gZWRpdE1vZGUoc2VsZWN0ZWRUYXNrKSB7XG5cbiAgICBwcm9qZWN0Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJwcm9qZWN0LWxpc3Qtbm9uZVwiKTtcblxuICAgIGNvbnN0IGVkaXRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtdGFzay1jb250YWluZXJcIik7XG4gICAgY29uc3QgbmV3Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5uZXd0YXNrXCIpO1xuXG4gICAgZWRpdENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiZWRpdC1ub3QtYWN0aXZlXCIpO1xuICAgIG5ld0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibmV3LW5vdC1hY3RpdmVcIik7XG5cbiAgICAvL3BvcHVsYXRlIHdpdGggZWRpdCBpbnB1dHNcbiAgICBlZGl0VGFza0lucHV0LnZhbHVlID0gc2VsZWN0ZWRUYXNrLm5hbWU7XG4gICAgZWRpdFRhc2tOb3RlLnZhbHVlID0gc2VsZWN0ZWRUYXNrLm5vdGVzO1xuICAgIGVkaXRUYXNrRGF0ZS52YWx1ZSA9IHNlbGVjdGVkVGFzay5kdWVEYXRlO1xuXG4gICAgZm9yIChpID0gMDsgaSA8IGVkaXRUYXNrUHJpb3JpdHkubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICBpZiAoZWRpdFRhc2tQcmlvcml0eVtpXS52YWx1ZSA9PSBzZWxlY3RlZFRhc2sucHJpb3JpdHkpIHtcbiAgICAgICAgICAgIGVkaXRUYXNrUHJpb3JpdHlbaV0uY2hlY2tlZCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgIH1cblxufVxuXG5mdW5jdGlvbiBleGl0RWRpdE1vZGUoKSB7XG5cbiAgICBjb25zdCBlZGl0Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lZGl0LXRhc2stY29udGFpbmVyXCIpO1xuICAgIGNvbnN0IG5ld0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubmV3dGFza1wiKTtcblxuICAgIGVkaXRDb250YWluZXIuY2xhc3NMaXN0LmFkZChcImVkaXQtbm90LWFjdGl2ZVwiKTtcbiAgICBuZXdDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcIm5ldy1ub3QtYWN0aXZlXCIpO1xuXG4gICAgZW5hYmxlTW9kZSgpO1xuXG4gICAgcHJvamVjdENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwicHJvamVjdC1saXN0LW5vbmVcIik7XG5cbn1cblxuLy9vcGVuIHNwZWNpZmljIGVkaXQgZGV0YWlsc1xudGFza3NDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcblxuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2J0bi10YXNrLWVkaXQnKSkge1xuXG4gICAgICAgIGRpc2FibGVNb2RlKCk7XG5cbiAgICAgICAgbGV0IGlkQXJyID0gZS50YXJnZXQuaWQuc3BsaXQoXCItXCIpO1xuICAgICAgICBsZXQgaWRUb0VkaXQgPSBpZEFyclsxXTtcblxuICAgICAgICBjb25zdCBzZWxlY3RlZFByb2plY3QgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PT0gc2VsZWN0ZWRQcm9qZWN0SWQpO1xuICAgICAgICBsZXQgc2VsZWN0ZWRUYXNrID0gc2VsZWN0ZWRQcm9qZWN0LnRhc2tzLmZpbmQodGFzayA9PiB0YXNrLmlkID09PSBpZFRvRWRpdCk7XG5cbiAgICAgICAgZWRpdE1vZGUoc2VsZWN0ZWRUYXNrKTtcblxuICAgICAgICAvL3N1Ym1pdCBlZGl0IGRldGFpbHNcbiAgICAgICAgZWRpdFRhc2tGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGUgPT4ge1xuXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIHNlbGVjdGVkVGFzayA9IHNlbGVjdGVkUHJvamVjdC50YXNrcy5maW5kKHRhc2sgPT4gdGFzay5pZCA9PT0gaWRUb0VkaXQpO1xuXG4gICAgICAgICAgICBjb25zdCB0YXNrTmFtZSA9IGVkaXRUYXNrSW5wdXQudmFsdWU7XG4gICAgICAgICAgICBjb25zdCB0YXNrRGF0ZSA9IGVkaXRUYXNrRGF0ZS52YWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IHRhc2tOb3RlID0gZWRpdFRhc2tOb3RlLnZhbHVlO1xuXG4gICAgICAgICAgICBsZXQgdGFza1ByaW9yaXR5ID0gXCJcIjtcblxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGVkaXRUYXNrUHJpb3JpdHkubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgIGlmIChlZGl0VGFza1ByaW9yaXR5W2ldLmNoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFza1ByaW9yaXR5ID0gZWRpdFRhc2tQcmlvcml0eVtpXS52YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VsZWN0ZWRUYXNrLm5hbWUgPSB0YXNrTmFtZTtcbiAgICAgICAgICAgIHNlbGVjdGVkVGFzay5ub3RlcyA9IHRhc2tOb3RlO1xuICAgICAgICAgICAgc2VsZWN0ZWRUYXNrLmR1ZURhdGUgPSB0YXNrRGF0ZTtcbiAgICAgICAgICAgIHNlbGVjdGVkVGFzay5wcmlvcml0eSA9IHRhc2tQcmlvcml0eTtcblxuICAgICAgICAgICAgc2F2ZSgpO1xuICAgICAgICAgICAgZXhpdEVkaXRNb2RlKCk7XG4gICAgICAgICAgICByZW5kZXIoKTtcbiAgICAgICAgfSlcblxuXG4gICAgICAgIC8vY2FuY2VsIGVkaXQgYnV0dG9uXG4gICAgICAgIGNvbnN0IGNhbmNlbEVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2J0bi1jYW5jZWwtZWRpdC10YXNrXCIpO1xuICAgICAgICBjYW5jZWxFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhpdEVkaXRNb2RlKCk7XG4gICAgICAgIH0pXG5cbiAgICB9XG59KVxuXG4vL2RlbGV0ZSBpbmRpdmlkdWFsIHRhc2tcbnRhc2tzQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG5cbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdidG4tdGFzay1kZWxldGUnKSkge1xuXG4gICAgICAgIGxldCBpZEFyciA9IGUudGFyZ2V0LmlkLnNwbGl0KFwiLVwiKTtcbiAgICAgICAgbGV0IGlkVG9EZWxldGUgPSBpZEFyclsxXTtcblxuICAgICAgICBjb25zdCBzZWxlY3RlZFByb2plY3QgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PT0gc2VsZWN0ZWRQcm9qZWN0SWQpO1xuICAgICAgICBzZWxlY3RlZFByb2plY3QudGFza3MgPSBzZWxlY3RlZFByb2plY3QudGFza3MuZmlsdGVyKHRhc2sgPT4gdGFzay5pZCAhPT0gaWRUb0RlbGV0ZSlcblxuICAgICAgICBzYXZlKCk7XG4gICAgICAgIHJlbmRlcigpO1xuXG4gICAgfVxufSlcblxuLy9kZWxldGUgc2VsZWN0ZWQgcHJvamVjdFxuZGVsZXRlUHJvamVjdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuXG4gICAgcHJvamVjdHMgPSBwcm9qZWN0cy5maWx0ZXIocHJvamVjdCA9PiBwcm9qZWN0LmlkICE9PSBzZWxlY3RlZFByb2plY3RJZCk7XG4gICAgc2VsZWN0ZWRQcm9qZWN0SWQgPSBudWxsO1xuXG4gICAgc2F2ZSgpO1xuICAgIHJlbmRlcigpO1xuXG59KVxuXG4vL2FkZCBuZXcgcHJvamVjdFxubmV3UHJvamVjdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZSA9PiB7XG5cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjb25zdCBwcm9qZWN0TmFtZSA9IG5ld1Byb2plY3RJbnB1dC52YWx1ZTtcbiAgICBjb25zdCBwcm9qZWN0ID0gY3JlYXRlUHJvamVjdChwcm9qZWN0TmFtZSk7XG5cbiAgICBuZXdQcm9qZWN0SW5wdXQudmFsdWUgPSBudWxsO1xuICAgIHByb2plY3RzLnB1c2gocHJvamVjdCk7XG5cbiAgICBzYXZlKCk7XG4gICAgcmVuZGVyKCk7XG59KVxuXG5cbi8vYWRkIG5ldyB0YXNrXG5uZXdUYXNrRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBlID0+IHtcblxuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGlmIChzZWxlY3RlZFByb2plY3RJZCA9PSBcIm51bGxcIiB8fCBzZWxlY3RlZFByb2plY3RJZCA9PT0gbnVsbCkge1xuXG4gICAgICAgIGFsZXJ0KFwiUGxlYXNlIHNlbGVjdCBhIHByb2plY3QgdG8gYWRkIHRoZSBuZXcgdGFzay5cIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB0YXNrTmFtZSA9IG5ld1Rhc2tJbnB1dC52YWx1ZTtcbiAgICBjb25zdCB0YXNrRGF0ZSA9IG5ld1Rhc2tEYXRlLnZhbHVlO1xuICAgIGNvbnN0IHRhc2tOb3RlID0gbmV3VGFza05vdGUudmFsdWU7XG4gICAgbGV0IHRhc2tQcmlvcml0eSA9IFwiXCI7XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgbmV3VGFza1ByaW9yaXR5Lmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgaWYgKG5ld1Rhc2tQcmlvcml0eVtpXS5jaGVja2VkKSB7XG4gICAgICAgICAgICB0YXNrUHJpb3JpdHkgPSBuZXdUYXNrUHJpb3JpdHlbaV0udmFsdWU7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIGlmICh0YXNrTmFtZSA9PSBudWxsIHx8IHRhc2tOYW1lID09PSAnJykgcmV0dXJuO1xuXG4gICAgY29uc3QgdGFzayA9IGNyZWF0ZVRhc2sodGFza05hbWUsIHRhc2tOb3RlLCB0YXNrRGF0ZSwgdGFza1ByaW9yaXR5KTtcbiAgICBuZXdUYXNrSW5wdXQudmFsdWUgPSBudWxsO1xuICAgIG5ld1Rhc2tOb3RlLnZhbHVlID0gbnVsbDtcblxuICAgIGNvbnN0IHNlbGVjdGVkUHJvamVjdCA9IHByb2plY3RzLmZpbmQocHJvamVjdCA9PiBwcm9qZWN0LmlkID09PSBzZWxlY3RlZFByb2plY3RJZCk7XG4gICAgc2VsZWN0ZWRQcm9qZWN0LnRhc2tzLnB1c2godGFzayk7XG5cbiAgICBzYXZlKCk7XG4gICAgcmVuZGVyKCk7XG59KVxuXG4vL2NyZWF0ZSBuZXcgcHJvamVjdFxuZnVuY3Rpb24gY3JlYXRlUHJvamVjdChuYW1lKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IERhdGUubm93KCkudG9TdHJpbmcoKSxcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgdGFza3M6IFtdXG4gICAgfVxufVxuXG4vL2NyZWF0ZSBuZXcgdGFza1xuZnVuY3Rpb24gY3JlYXRlVGFzayhuYW1lLCBub3RlcywgZGF0ZSwgcHJpb3JpdHkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpZDogRGF0ZS5ub3coKS50b1N0cmluZygpLFxuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICBjb21wbGV0ZTogZmFsc2UsXG4gICAgICAgIGR1ZURhdGU6IGRhdGUsXG4gICAgICAgIG5vdGVzOiBub3RlcyxcbiAgICAgICAgcHJpb3JpdHk6IHByaW9yaXR5XG4gICAgfVxufVxuXG4vL3NhdmUgcHJvamVjdCBsaXN0cyBhbmQgc2VsZWN0ZWQgcHJvamVjdCBpZFxuZnVuY3Rpb24gc2F2ZSgpIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncHJvamVjdC5saXN0cycsIEpTT04uc3RyaW5naWZ5KHByb2plY3RzKSk7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Byb2plY3Quc2VsZWN0ZWRMaXN0SWQnLCBzZWxlY3RlZFByb2plY3RJZCk7XG59XG5cbi8vcmVuZGVyIGNvbnRlbnRcbmZ1bmN0aW9uIHJlbmRlcigpIHtcblxuICAgIGNsZWFyRWxlbWVudChwcm9qZWN0Q29udGFpbmVyKTtcbiAgICByZW5kZXJQcm9qZWN0TGlzdHMoKTtcblxuICAgIGNvbnN0IHNlbGVjdGVkUHJvamVjdCA9IHByb2plY3RzLmZpbmQocHJvamVjdCA9PiBwcm9qZWN0LmlkID09PSBzZWxlY3RlZFByb2plY3RJZCk7XG5cbiAgICAvL2NoZWNrIGlmIGhhdmluZyBzZWxlY3RlZCBwcm9qZWN0IHRvIGRpc3BsYXkgdGhlIHByb2plY3QgdG8gZG9cbiAgICBpZiAoc2VsZWN0ZWRQcm9qZWN0SWQgPT0gXCJudWxsXCIgfHwgc2VsZWN0ZWRQcm9qZWN0SWQgPT09IG51bGwpIHtcblxuICAgICAgICBwcm9qZWN0RGlzcGxheUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgfSBlbHNlIHtcblxuICAgICAgICBwcm9qZWN0RGlzcGxheUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgIHByb2plY3RUaXRsZUVsZW1lbnQuaW5uZXJUZXh0ID0gc2VsZWN0ZWRQcm9qZWN0Lm5hbWU7XG4gICAgICAgIHJlbmRlclRhc2tDb3VudChzZWxlY3RlZFByb2plY3QpO1xuICAgICAgICBjbGVhckVsZW1lbnQodGFza3NDb250YWluZXIpO1xuICAgICAgICByZW5kZXJUYXNrcyhzZWxlY3RlZFByb2plY3QpO1xuXG4gICAgfVxuXG59XG5cbi8vcmVuZGVyIHRhc2tcbmZ1bmN0aW9uIHJlbmRlclRhc2tzKHNlbGVjdGVkUHJvamVjdCkge1xuXG4gICAgc2VsZWN0ZWRQcm9qZWN0LnRhc2tzLmZvckVhY2godGFzayA9PiB7XG5cbiAgICAgICAgY29uc3QgdGFza0VsZW1lbnQgPSBkb2N1bWVudC5pbXBvcnROb2RlKHRhc2tUZW1wbGF0ZS5jb250ZW50LCB0cnVlKTtcblxuICAgICAgICBjb25zdCB0YXNrUm93ID0gdGFza0VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi50YXNrLXJvd1wiKTtcblxuICAgICAgICBpZiAodGFzay5wcmlvcml0eSA9PSBcImxvd1wiKSB7XG4gICAgICAgICAgICB0YXNrUm93LmNsYXNzTGlzdC5hZGQoXCJ0YXNrLWxvd1wiKTtcbiAgICAgICAgfSBlbHNlIGlmICh0YXNrLnByaW9yaXR5ID09IFwibWVkaXVtXCIpIHtcbiAgICAgICAgICAgIHRhc2tSb3cuY2xhc3NMaXN0LmFkZChcInRhc2stbWVkaXVtXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFza1Jvdy5jbGFzc0xpc3QuYWRkKFwidGFzay1oaWdoXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY2hlY2tib3ggPSB0YXNrRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIik7XG4gICAgICAgIGNoZWNrYm94LmlkID0gdGFzay5pZDtcbiAgICAgICAgY2hlY2tib3guY2hlY2tlZCA9IHRhc2suY29tcGxldGU7XG5cbiAgICAgICAgY29uc3QgbGFiZWwgPSB0YXNrRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwibGFiZWxcIik7XG4gICAgICAgIGxhYmVsLmh0bWxGb3IgPSB0YXNrLmlkO1xuICAgICAgICBsYWJlbC5hcHBlbmQodGFzay5uYW1lKTtcblxuICAgICAgICBjb25zdCBkYXRlID0gdGFza0VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi50YXNrLWRhdGVcIik7XG4gICAgICAgIGRhdGUuYXBwZW5kKHRhc2suZHVlRGF0ZSk7XG5cbiAgICAgICAgY29uc3QgcHJpb3JpdHkgPSB0YXNrRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnRhc2stcHJpb3JpdHlcIik7XG4gICAgICAgIHByaW9yaXR5LmFwcGVuZCh0YXNrLnByaW9yaXR5KTtcblxuICAgICAgICBjb25zdCBub3RlcyA9IHRhc2tFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGFzay1ub3Rlc1wiKTtcbiAgICAgICAgbm90ZXMuYXBwZW5kKHRhc2subm90ZXMpO1xuXG4gICAgICAgIGNvbnN0IGRldGFpbHNCdXR0b24gPSB0YXNrRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ0bi10YXNrLWRldGFpbHNcIik7XG4gICAgICAgIGRldGFpbHNCdXR0b24uaWQgPSBcImRldGFpbHMtXCIgKyB0YXNrLmlkO1xuXG4gICAgICAgIGNvbnN0IGVkaXRCdXR0b24gPSB0YXNrRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ0bi10YXNrLWVkaXRcIik7XG4gICAgICAgIGVkaXRCdXR0b24uaWQgPSBcImVkaXQtXCIgKyB0YXNrLmlkO1xuXG4gICAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IHRhc2tFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYnRuLXRhc2stZGVsZXRlXCIpO1xuICAgICAgICBkZWxldGVCdXR0b24uaWQgPSBcImRlbGV0ZS1cIiArIHRhc2suaWQ7XG5cbiAgICAgICAgY29uc3QgZGV0YWlsc1JvdyA9IHRhc2tFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGFzay1kZXRhaWxzLXJvd1wiKTtcbiAgICAgICAgZGV0YWlsc1Jvdy5pZCA9IFwicm93LVwiICsgdGFzay5pZDtcblxuICAgICAgICB0YXNrc0NvbnRhaW5lci5hcHBlbmRDaGlsZCh0YXNrRWxlbWVudCk7XG5cbiAgICB9KVxufVxuXG5mdW5jdGlvbiByZW5kZXJUYXNrQ291bnQoc2VsZWN0ZWRQcm9qZWN0KSB7XG5cbiAgICBjb25zdCBpbmNvbXBsZXRlVGFza0NvdW50ID0gc2VsZWN0ZWRQcm9qZWN0LnRhc2tzLmZpbHRlcih0YXNrID0+ICF0YXNrLmNvbXBsZXRlKS5sZW5ndGg7XG4gICAgY29uc3QgdGFza1N0cmluZyA9IGluY29tcGxldGVUYXNrQ291bnQgPT09IDEgPyBcInRhc2tcIiA6IFwidGFza3NcIjtcbiAgICB0YXNrc0NvdW50RWxlbWVudC5pbm5lclRleHQgPSBgJHtpbmNvbXBsZXRlVGFza0NvdW50fSAke3Rhc2tTdHJpbmd9IHJlbWFpbmluZ2A7XG5cbn1cblxuXG5mdW5jdGlvbiByZW5kZXJQcm9qZWN0TGlzdHMoKSB7XG5cbiAgICAvL3JlbmRlciBlYWNoIHByb2plY3RcbiAgICBwcm9qZWN0cy5mb3JFYWNoKHByb2plY3QgPT4ge1xuXG4gICAgICAgIGNvbnN0IHByb2pFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICAgICAgICBwcm9qRWxlbWVudC5kYXRhc2V0LnByb2pJZCA9IHByb2plY3QuaWQ7XG4gICAgICAgIHByb2pFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJwcm9qZWN0LWxpc3QtbmFtZVwiKTtcbiAgICAgICAgcHJvakVsZW1lbnQuaW5uZXJUZXh0ID0gcHJvamVjdC5uYW1lO1xuXG4gICAgICAgIGlmIChwcm9qZWN0LmlkID09PSBzZWxlY3RlZFByb2plY3RJZCkge1xuXG4gICAgICAgICAgICBwcm9qRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlLXByb2plY3RcIik7XG4gICAgICAgIH1cblxuICAgICAgICBwcm9qZWN0Q29udGFpbmVyLmFwcGVuZENoaWxkKHByb2pFbGVtZW50KTtcblxuICAgIH0pXG59XG5cbmZ1bmN0aW9uIGNsZWFyRWxlbWVudChlbGVtZW50KSB7XG5cbiAgICB3aGlsZSAoZWxlbWVudC5maXJzdENoaWxkKSB7XG4gICAgICAgIGVsZW1lbnQucmVtb3ZlQ2hpbGQoZWxlbWVudC5maXJzdENoaWxkKTtcbiAgICB9XG5cbn1cblxucmVuZGVyKCk7Il0sIm5hbWVzIjpbInByb2plY3RDb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJuZXdQcm9qZWN0Rm9ybSIsIm5ld1Byb2plY3RJbnB1dCIsImRlbGV0ZVByb2plY3RCdXR0b24iLCJuZXdQcm9qZWN0QnV0dG9uIiwicHJvamVjdERpc3BsYXlDb250YWluZXIiLCJwcm9qZWN0VGl0bGVFbGVtZW50IiwidGFza3NDb3VudEVsZW1lbnQiLCJ0YXNrc0NvbnRhaW5lciIsInRhc2tEZWxldGVCdXR0b24iLCJ0YXNrVGVtcGxhdGUiLCJnZXRFbGVtZW50QnlJZCIsIm5ld1Rhc2tGb3JtIiwibmV3VGFza0lucHV0IiwibmV3VGFza0RhdGUiLCJuZXdUYXNrTm90ZSIsIm5ld1Rhc2tQcmlvcml0eSIsImdldEVsZW1lbnRzQnlOYW1lIiwibmV3VGFza0J1dHRvbiIsImVkaXRUYXNrRm9ybSIsImVkaXRUYXNrSW5wdXQiLCJlZGl0VGFza0RhdGUiLCJlZGl0VGFza05vdGUiLCJlZGl0VGFza1ByaW9yaXR5IiwicHJvamVjdHMiLCJKU09OIiwicGFyc2UiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2VsZWN0ZWRQcm9qZWN0SWQiLCJleGl0RWRpdE1vZGUiLCJlZGl0Q29udGFpbmVyIiwibmV3Q29udGFpbmVyIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwiZGlzYWJsZWQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImJ0biIsImNoZWNrYm94IiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJpIiwibGVuZ3RoIiwidHlwZSIsImVuYWJsZU1vZGUiLCJzYXZlIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsInJlbmRlciIsImNsZWFyRWxlbWVudCIsInByb2plY3QiLCJwcm9qRWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJkYXRhc2V0IiwicHJvaklkIiwiaWQiLCJpbm5lclRleHQiLCJuYW1lIiwiYXBwZW5kQ2hpbGQiLCJzZWxlY3RlZFByb2plY3QiLCJmaW5kIiwic3R5bGUiLCJkaXNwbGF5IiwicmVuZGVyVGFza0NvdW50IiwidGFza3MiLCJ0YXNrIiwidGFza0VsZW1lbnQiLCJpbXBvcnROb2RlIiwiY29udGVudCIsInRhc2tSb3ciLCJwcmlvcml0eSIsImNoZWNrZWQiLCJjb21wbGV0ZSIsImxhYmVsIiwiaHRtbEZvciIsImFwcGVuZCIsImR1ZURhdGUiLCJub3RlcyIsInJlbmRlclRhc2tzIiwiaW5jb21wbGV0ZVRhc2tDb3VudCIsImZpbHRlciIsInRhc2tTdHJpbmciLCJlbGVtZW50IiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ0YXJnZXQiLCJ0YWdOYW1lIiwidG9Mb3dlckNhc2UiLCJhbGVydCIsImNvbnRhaW5zIiwic3BsaXQiLCJ0b2dnbGUiLCJkaXNhYmxlTW9kZSIsImlkVG9FZGl0Iiwic2VsZWN0ZWRUYXNrIiwidmFsdWUiLCJlZGl0TW9kZSIsInByZXZlbnREZWZhdWx0IiwidGFza05hbWUiLCJ0YXNrRGF0ZSIsInRhc2tOb3RlIiwidGFza1ByaW9yaXR5IiwiaWRUb0RlbGV0ZSIsIkRhdGUiLCJub3ciLCJ0b1N0cmluZyIsInB1c2giLCJkYXRlIl0sInNvdXJjZVJvb3QiOiIifQ==